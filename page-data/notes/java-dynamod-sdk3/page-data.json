{"componentChunkName":"component---src-templates-blog-post-js","path":"/notes/java-dynamod-sdk3","result":{"data":{"markdownRemark":{"html":"<p>I had significant issues integrating DynamoDB into one of our projects. The main challenge was finding suitable documentation, as many sources describe integration with AWS SDK version 1.x.</p>\n<p>In true Scout's honor, here's a brief description of how to integrate DynamoDB using AWS SDK 2.x into a Spring Boot project.</p>\n<p>In the project, start the following Docker container to have a local DynamoDB for development purposes. Here's an excerpt from our <code class=\"language-text\">docker-compose.yml</code>:</p>\n<div class=\"gatsby-highlight\" data-language=\"yaml\"><pre class=\"language-yaml\"><code class=\"language-yaml\"><span class=\"token key atrule\">dynamodb</span><span class=\"token punctuation\">:</span>\n  <span class=\"token key atrule\">image</span><span class=\"token punctuation\">:</span> amazon/dynamodb<span class=\"token punctuation\">-</span>local\n  <span class=\"token key atrule\">container_name</span><span class=\"token punctuation\">:</span> sis<span class=\"token punctuation\">-</span>dynamodb\n  <span class=\"token key atrule\">ports</span><span class=\"token punctuation\">:</span>\n    <span class=\"token punctuation\">-</span> <span class=\"token string\">\"8000:8000\"</span>\n  <span class=\"token key atrule\">command</span><span class=\"token punctuation\">:</span> <span class=\"token string\">\"-jar DynamoDBLocal.jar -sharedDb -dbPath .\"</span>\n  <span class=\"token key atrule\">environment</span><span class=\"token punctuation\">:</span>\n    <span class=\"token key atrule\">AWS_ACCESS_KEY_ID</span><span class=\"token punctuation\">:</span> <span class=\"token string\">'DUMMYIDEXAMPLE'</span>\n    <span class=\"token key atrule\">AWS_SECRET_ACCESS_KEY</span><span class=\"token punctuation\">:</span> <span class=\"token string\">'DUMMYEXAMPLEKEY'</span>\n    <span class=\"token key atrule\">AWS_REGION</span><span class=\"token punctuation\">:</span> <span class=\"token string\">'eu-central-1'</span></code></pre></div>\n<p>We use the AWS SDK for integration. Include the following Gradle import:</p>\n<div class=\"gatsby-highlight\" data-language=\"gradle\"><pre class=\"language-gradle\"><code class=\"language-gradle\"><span class=\"token keyword\">implementation</span> <span class=\"token string\">'software.amazon.awssdk:dynamodb'</span> <span class=\"token comment\">//general integration</span>\n<span class=\"token keyword\">implementation</span> <span class=\"token string\">'software.amazon.awssdk:dynamodb-enhanced'</span> <span class=\"token comment\">//enhanced methods to work with the dynamo in a more ORM manner</span></code></pre></div>\n<p>The following Spring configuration is necessary to connect DynamoDB locally as well as on AWS:</p>\n<div class=\"gatsby-highlight\" data-language=\"java\"><pre class=\"language-java\"><code class=\"language-java\"><span class=\"token annotation punctuation\">@Configuration</span>\n<span class=\"token annotation punctuation\">@EnableConfigurationProperties</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">AwsDynamoDBConfig<span class=\"token punctuation\">.</span>Config</span><span class=\"token punctuation\">.</span><span class=\"token keyword\">class</span><span class=\"token punctuation\">)</span>\n<span class=\"token keyword\">public</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">AwsDynamoDBConfig</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">private</span> <span class=\"token keyword\">static</span> <span class=\"token keyword\">final</span> <span class=\"token class-name\">String</span> <span class=\"token constant\">DEV_ACCESS_KEY_ID</span> <span class=\"token operator\">=</span> <span class=\"token string\">\"DUMMYIDEXAMPLE\"</span><span class=\"token punctuation\">;</span>\n  <span class=\"token keyword\">private</span> <span class=\"token keyword\">static</span> <span class=\"token keyword\">final</span> <span class=\"token class-name\">String</span> <span class=\"token constant\">DEV_SECRET_ACCESS_KEY</span> <span class=\"token operator\">=</span> <span class=\"token string\">\"DUMMYEXAMPLEKEY\"</span><span class=\"token punctuation\">;</span>\n\n  <span class=\"token annotation punctuation\">@Bean</span>\n  <span class=\"token annotation punctuation\">@Profile</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"dev\"</span><span class=\"token punctuation\">)</span>\n  <span class=\"token keyword\">public</span> <span class=\"token class-name\">DynamoDbClient</span> <span class=\"token function\">amazonDynamoDbDev</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">Config</span> config<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">return</span> <span class=\"token class-name\">DynamoDbClient</span><span class=\"token punctuation\">.</span><span class=\"token function\">builder</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n      <span class=\"token punctuation\">.</span><span class=\"token function\">credentialsProvider</span><span class=\"token punctuation\">(</span>\n          <span class=\"token class-name\">StaticCredentialsProvider</span><span class=\"token punctuation\">.</span><span class=\"token function\">create</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">AwsBasicCredentials</span><span class=\"token punctuation\">.</span><span class=\"token function\">create</span><span class=\"token punctuation\">(</span><span class=\"token constant\">DEV_ACCESS_KEY_ID</span><span class=\"token punctuation\">,</span> <span class=\"token constant\">DEV_SECRET_ACCESS_KEY</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\n      <span class=\"token punctuation\">.</span><span class=\"token function\">endpointOverride</span><span class=\"token punctuation\">(</span>config<span class=\"token punctuation\">.</span><span class=\"token function\">url</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\n      <span class=\"token punctuation\">.</span><span class=\"token function\">region</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">Region</span><span class=\"token punctuation\">.</span><span class=\"token constant\">EU_CENTRAL_1</span><span class=\"token punctuation\">)</span>\n      <span class=\"token punctuation\">.</span><span class=\"token function\">build</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span>\n\n  <span class=\"token annotation punctuation\">@Bean</span>\n  <span class=\"token annotation punctuation\">@Profile</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"!dev\"</span><span class=\"token punctuation\">)</span>\n    <span class=\"token keyword\">public</span> <span class=\"token class-name\">DynamoDbClient</span> <span class=\"token function\">amazonDynamoDbProd</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">return</span> <span class=\"token class-name\">DynamoDbClient</span><span class=\"token punctuation\">.</span><span class=\"token function\">create</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span>\n\n  <span class=\"token annotation punctuation\">@Bean</span>\n  <span class=\"token keyword\">public</span> <span class=\"token class-name\">DynamoDbEnhancedClient</span> <span class=\"token function\">createDynamoDbEnhancedClient</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">DynamoDbClient</span> client<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">return</span> <span class=\"token class-name\">DynamoDbEnhancedClient</span><span class=\"token punctuation\">.</span><span class=\"token function\">builder</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">dynamoDbClient</span><span class=\"token punctuation\">(</span>client<span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">build</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span>\n\n  <span class=\"token annotation punctuation\">@ConfigurationProperties</span><span class=\"token punctuation\">(</span>prefix <span class=\"token operator\">=</span> <span class=\"token string\">\"dynamodb\"</span><span class=\"token punctuation\">)</span>\n  <span class=\"token keyword\">public</span> <span class=\"token keyword\">record</span> <span class=\"token class-name\">Config</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">URI</span> url<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span><span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>Since the DynamoDB schema is schema-less, it is not necessary to predefine the entire schema. However, we need to create a table with keys and possibly secondary indices.</p>\n<p>For local development:</p>\n<div class=\"gatsby-highlight\" data-language=\"java\"><pre class=\"language-java\"><code class=\"language-java\"><span class=\"token annotation punctuation\">@Service</span>\n<span class=\"token annotation punctuation\">@Slf4j</span>\n<span class=\"token annotation punctuation\">@RequiredArgsConstructor</span>\n<span class=\"token annotation punctuation\">@Profile</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"dev\"</span><span class=\"token punctuation\">)</span>\n<span class=\"token keyword\">public</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">DynamoDBInitService</span> <span class=\"token punctuation\">{</span>\n\n    <span class=\"token keyword\">private</span> <span class=\"token keyword\">final</span> <span class=\"token class-name\">DynamoDbClient</span> amazonDynamoDB<span class=\"token punctuation\">;</span>\n\n    <span class=\"token annotation punctuation\">@PostConstruct</span>\n    <span class=\"token keyword\">public</span> <span class=\"token keyword\">void</span> <span class=\"token function\">initialiseTables</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        log<span class=\"token punctuation\">.</span><span class=\"token function\">info</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"Initialising DynamoDB tables\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        <span class=\"token class-name\">String</span> tableName <span class=\"token operator\">=</span> <span class=\"token class-name\">SatelliteImage</span><span class=\"token punctuation\">.</span><span class=\"token constant\">TABLE_NAME</span><span class=\"token punctuation\">;</span>\n        <span class=\"token keyword\">try</span> <span class=\"token punctuation\">{</span>\n\n            <span class=\"token class-name\">DescribeTableRequest</span> describeTableRequest <span class=\"token operator\">=</span>\n                    <span class=\"token class-name\">DescribeTableRequest</span><span class=\"token punctuation\">.</span><span class=\"token function\">builder</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">tableName</span><span class=\"token punctuation\">(</span>tableName<span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">build</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n            <span class=\"token class-name\">DescribeTableResponse</span> response <span class=\"token operator\">=</span> amazonDynamoDB<span class=\"token punctuation\">.</span><span class=\"token function\">describeTable</span><span class=\"token punctuation\">(</span>describeTableRequest<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n            <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span><span class=\"token class-name\">TableStatus</span><span class=\"token punctuation\">.</span><span class=\"token constant\">ACTIVE</span><span class=\"token punctuation\">.</span><span class=\"token function\">equals</span><span class=\"token punctuation\">(</span>response<span class=\"token punctuation\">.</span><span class=\"token function\">table</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">tableStatus</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n                log<span class=\"token punctuation\">.</span><span class=\"token function\">info</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"Table {} is active\"</span><span class=\"token punctuation\">,</span> tableName<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n            <span class=\"token punctuation\">}</span>\n        <span class=\"token punctuation\">}</span> <span class=\"token keyword\">catch</span> <span class=\"token punctuation\">(</span><span class=\"token class-name\">ResourceNotFoundException</span> e<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n            log<span class=\"token punctuation\">.</span><span class=\"token function\">info</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"Table {} does not exist\"</span><span class=\"token punctuation\">,</span> tableName<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n            log<span class=\"token punctuation\">.</span><span class=\"token function\">info</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"Creating table {}\"</span><span class=\"token punctuation\">,</span> tableName<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n            <span class=\"token class-name\">CreateTableRequest</span> createTableRequest <span class=\"token operator\">=</span> <span class=\"token class-name\">CreateTableRequest</span><span class=\"token punctuation\">.</span><span class=\"token function\">builder</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n                    <span class=\"token punctuation\">.</span><span class=\"token function\">tableName</span><span class=\"token punctuation\">(</span>tableName<span class=\"token punctuation\">)</span>\n                    <span class=\"token punctuation\">.</span><span class=\"token function\">keySchema</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">KeySchemaElement</span><span class=\"token punctuation\">.</span><span class=\"token function\">builder</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n                            <span class=\"token punctuation\">.</span><span class=\"token function\">keyType</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">KeyType</span><span class=\"token punctuation\">.</span><span class=\"token constant\">HASH</span><span class=\"token punctuation\">)</span>\n                            <span class=\"token punctuation\">.</span><span class=\"token function\">attributeName</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"id\"</span><span class=\"token punctuation\">)</span>\n                            <span class=\"token punctuation\">.</span><span class=\"token function\">build</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\n                    <span class=\"token punctuation\">.</span><span class=\"token function\">attributeDefinitions</span><span class=\"token punctuation\">(</span>\n                            <span class=\"token class-name\">AttributeDefinition</span><span class=\"token punctuation\">.</span><span class=\"token function\">builder</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n                                    <span class=\"token punctuation\">.</span><span class=\"token function\">attributeName</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"id\"</span><span class=\"token punctuation\">)</span>\n                                    <span class=\"token punctuation\">.</span><span class=\"token function\">attributeType</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">ScalarAttributeType<span class=\"token punctuation\">.</span>S</span><span class=\"token punctuation\">)</span>\n                                    <span class=\"token punctuation\">.</span><span class=\"token function\">build</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\n                            <span class=\"token class-name\">AttributeDefinition</span><span class=\"token punctuation\">.</span><span class=\"token function\">builder</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n                                    <span class=\"token punctuation\">.</span><span class=\"token function\">attributeName</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"field_id\"</span><span class=\"token punctuation\">)</span>\n                                    <span class=\"token punctuation\">.</span><span class=\"token function\">attributeType</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">ScalarAttributeType<span class=\"token punctuation\">.</span>S</span><span class=\"token punctuation\">)</span>\n                                    <span class=\"token punctuation\">.</span><span class=\"token function\">build</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\n                            <span class=\"token class-name\">AttributeDefinition</span><span class=\"token punctuation\">.</span><span class=\"token function\">builder</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n                                    <span class=\"token punctuation\">.</span><span class=\"token function\">attributeName</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"image_from\"</span><span class=\"token punctuation\">)</span>\n                                    <span class=\"token punctuation\">.</span><span class=\"token function\">attributeType</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">ScalarAttributeType<span class=\"token punctuation\">.</span>S</span><span class=\"token punctuation\">)</span>\n                                    <span class=\"token punctuation\">.</span><span class=\"token function\">build</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\n                    <span class=\"token punctuation\">.</span><span class=\"token function\">globalSecondaryIndexes</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">GlobalSecondaryIndex</span><span class=\"token punctuation\">.</span><span class=\"token function\">builder</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n                            <span class=\"token punctuation\">.</span><span class=\"token function\">indexName</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"FieldIDImageFromDateIndex\"</span><span class=\"token punctuation\">)</span>\n                            <span class=\"token punctuation\">.</span><span class=\"token function\">keySchema</span><span class=\"token punctuation\">(</span>\n                                    <span class=\"token class-name\">KeySchemaElement</span><span class=\"token punctuation\">.</span><span class=\"token function\">builder</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n                                            <span class=\"token punctuation\">.</span><span class=\"token function\">keyType</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">KeyType</span><span class=\"token punctuation\">.</span><span class=\"token constant\">HASH</span><span class=\"token punctuation\">)</span>\n                                            <span class=\"token punctuation\">.</span><span class=\"token function\">attributeName</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"field_id\"</span><span class=\"token punctuation\">)</span>\n                                            <span class=\"token punctuation\">.</span><span class=\"token function\">build</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\n                                    <span class=\"token class-name\">KeySchemaElement</span><span class=\"token punctuation\">.</span><span class=\"token function\">builder</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n                                            <span class=\"token punctuation\">.</span><span class=\"token function\">keyType</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">KeyType</span><span class=\"token punctuation\">.</span><span class=\"token constant\">RANGE</span><span class=\"token punctuation\">)</span>\n                                            <span class=\"token punctuation\">.</span><span class=\"token function\">attributeName</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"image_from\"</span><span class=\"token punctuation\">)</span>\n                                            <span class=\"token punctuation\">.</span><span class=\"token function\">build</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\n                            <span class=\"token punctuation\">.</span><span class=\"token function\">projection</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">Projection</span><span class=\"token punctuation\">.</span><span class=\"token function\">builder</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n                                    <span class=\"token punctuation\">.</span><span class=\"token function\">projectionType</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">ProjectionType</span><span class=\"token punctuation\">.</span><span class=\"token constant\">ALL</span><span class=\"token punctuation\">)</span>\n                                    <span class=\"token punctuation\">.</span><span class=\"token function\">build</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\n                            <span class=\"token punctuation\">.</span><span class=\"token function\">provisionedThroughput</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">ProvisionedThroughput</span><span class=\"token punctuation\">.</span><span class=\"token function\">builder</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n                                    <span class=\"token punctuation\">.</span><span class=\"token function\">readCapacityUnits</span><span class=\"token punctuation\">(</span><span class=\"token number\">10L</span><span class=\"token punctuation\">)</span>\n                                    <span class=\"token punctuation\">.</span><span class=\"token function\">writeCapacityUnits</span><span class=\"token punctuation\">(</span><span class=\"token number\">10L</span><span class=\"token punctuation\">)</span>\n                                    <span class=\"token punctuation\">.</span><span class=\"token function\">build</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\n                            <span class=\"token punctuation\">.</span><span class=\"token function\">build</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\n                    <span class=\"token punctuation\">.</span><span class=\"token function\">provisionedThroughput</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">ProvisionedThroughput</span><span class=\"token punctuation\">.</span><span class=\"token function\">builder</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n                            <span class=\"token punctuation\">.</span><span class=\"token function\">readCapacityUnits</span><span class=\"token punctuation\">(</span><span class=\"token number\">10L</span><span class=\"token punctuation\">)</span>\n                            <span class=\"token punctuation\">.</span><span class=\"token function\">writeCapacityUnits</span><span class=\"token punctuation\">(</span><span class=\"token number\">10L</span><span class=\"token punctuation\">)</span>\n                            <span class=\"token punctuation\">.</span><span class=\"token function\">build</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\n                    <span class=\"token punctuation\">.</span><span class=\"token function\">build</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n            <span class=\"token keyword\">try</span> <span class=\"token punctuation\">{</span>\n                amazonDynamoDB<span class=\"token punctuation\">.</span><span class=\"token function\">createTable</span><span class=\"token punctuation\">(</span>createTableRequest<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n                log<span class=\"token punctuation\">.</span><span class=\"token function\">info</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"Table {} created\"</span><span class=\"token punctuation\">,</span> tableName<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n            <span class=\"token punctuation\">}</span> <span class=\"token keyword\">catch</span> <span class=\"token punctuation\">(</span><span class=\"token class-name\">DynamoDbException</span> ex<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n                log<span class=\"token punctuation\">.</span><span class=\"token function\">error</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"Error creating table {}\"</span><span class=\"token punctuation\">,</span> tableName<span class=\"token punctuation\">,</span> ex<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n            <span class=\"token punctuation\">}</span>\n        <span class=\"token punctuation\">}</span>\n    <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>On the AWS side, this structure is described using IaaC, in our case, CloudFormation. Here's an excerpt from the CloudFormation template:</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">  SatelliteImageDynamoDB:\n    Type: 'AWS::DynamoDB::Table'\n    Properties:\n      TableName: 'satellite_image'\n      AttributeDefinitions:\n        - AttributeName: \"id\"\n          AttributeType: \"S\"\n        - AttributeName: \"field_id\"\n          AttributeType: \"S\"\n        - AttributeName: \"image_from\"\n          AttributeType: \"S\"\n      KeySchema:\n        - AttributeName: \"id\"\n          KeyType: \"HASH\"\n      ProvisionedThroughput:\n        ReadCapacityUnits: 10\n        WriteCapacityUnits: 10\n      GlobalSecondaryIndexes:\n        - IndexName: \"FieldIDImageFromDateIndex\"\n          KeySchema:\n            - AttributeName: \"field_id\"\n              KeyType: \"HASH\"\n            - AttributeName: \"image_from\"\n              KeyType: \"RANGE\"\n          Projection:\n            ProjectionType: \"ALL\"\n          ProvisionedThroughput:\n            ReadCapacityUnits: 10\n            WriteCapacityUnits: 10</code></pre></div>\n<p>For easier handling, we've created a kind of \"entity\" to be stored in DynamoDB:</p>\n<div class=\"gatsby-highlight\" data-language=\"java\"><pre class=\"language-java\"><code class=\"language-java\"><span class=\"token annotation punctuation\">@DynamoDbBean</span>\n<span class=\"token annotation punctuation\">@Getter</span>\n<span class=\"token annotation punctuation\">@Setter</span>\n<span class=\"token annotation punctuation\">@Builder</span>\n<span class=\"token annotation punctuation\">@AllArgsConstructor</span>\n<span class=\"token annotation punctuation\">@NoArgsConstructor</span>\n<span class=\"token keyword\">public</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">SatelliteImage</span> <span class=\"token punctuation\">{</span>\n\n    <span class=\"token keyword\">public</span> <span class=\"token keyword\">static</span> <span class=\"token keyword\">final</span> <span class=\"token class-name\">String</span> <span class=\"token constant\">TABLE_NAME</span> <span class=\"token operator\">=</span> <span class=\"token string\">\"satellite_image\"</span><span class=\"token punctuation\">;</span>\n\n    <span class=\"token keyword\">private</span> <span class=\"token class-name\">UUID</span> id<span class=\"token punctuation\">;</span>\n    <span class=\"token keyword\">private</span> <span class=\"token class-name\">UUID</span> fieldId<span class=\"token punctuation\">;</span>\n    <span class=\"token keyword\">private</span> <span class=\"token class-name\">LocalDate</span> imageFrom<span class=\"token punctuation\">;</span>\n    <span class=\"token keyword\">private</span> <span class=\"token class-name\">String</span> s3Path<span class=\"token punctuation\">;</span>\n    <span class=\"token keyword\">private</span> <span class=\"token keyword\">double</span> cloudCoverage<span class=\"token punctuation\">;</span>\n    <span class=\"token keyword\">private</span> <span class=\"token class-name\">Instant</span> creationDate<span class=\"token punctuation\">;</span>\n\n    <span class=\"token annotation punctuation\">@DynamoDbPartitionKey</span>\n    <span class=\"token keyword\">public</span> <span class=\"token class-name\">UUID</span> <span class=\"token function\">getId</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token keyword\">return</span> id<span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n\n    <span class=\"token annotation punctuation\">@DynamoDbAttribute</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"field_id\"</span><span class=\"token punctuation\">)</span>\n    <span class=\"token keyword\">public</span> <span class=\"token class-name\">UUID</span> <span class=\"token function\">getFieldId</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token keyword\">return</span> fieldId<span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n\n    <span class=\"token annotation punctuation\">@DynamoDbAttribute</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"image_from\"</span><span class=\"token punctuation\">)</span>\n    <span class=\"token keyword\">public</span> <span class=\"token class-name\">LocalDate</span> <span class=\"token function\">getImageFrom</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token keyword\">return</span> imageFrom<span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n\n    <span class=\"token annotation punctuation\">@DynamoDbAttribute</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"s3_path\"</span><span class=\"token punctuation\">)</span>\n    <span class=\"token keyword\">public</span> <span class=\"token class-name\">String</span> <span class=\"token function\">getS3Path</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token keyword\">return</span> s3Path<span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n\n    <span class=\"token annotation punctuation\">@DynamoDbAttribute</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"cloud_coverage\"</span><span class=\"token punctuation\">)</span>\n    <span class=\"token keyword\">public</span> <span class=\"token keyword\">double</span> <span class=\"token function\">getCloudCoverage</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token keyword\">return</span> cloudCoverage<span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n\n    <span class=\"token annotation punctuation\">@DynamoDbAttribute</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"creation_date\"</span><span class=\"token punctuation\">)</span>\n    <span class=\"token keyword\">public</span> <span class=\"token class-name\">Instant</span> <span class=\"token function\">getCreationDate</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token keyword\">return</span> creationDate<span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>To persist such an object, one must do the following:</p>\n<div class=\"gatsby-highlight\" data-language=\"java\"><pre class=\"language-java\"><code class=\"language-java\">    <span class=\"token keyword\">private</span> <span class=\"token keyword\">final</span> <span class=\"token class-name\">DynamoDbEnhancedClient</span> dynamoDbEnhancedClient<span class=\"token punctuation\">;</span>\n\n    <span class=\"token keyword\">private</span> <span class=\"token keyword\">void</span> <span class=\"token function\">store</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">SatelliteImage</span> satelliteImage<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token class-name\">DynamoDbTable</span><span class=\"token generics\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">SatelliteImage</span><span class=\"token punctuation\">></span></span> table <span class=\"token operator\">=</span> dynamoDbEnhancedClient<span class=\"token punctuation\">.</span><span class=\"token function\">table</span><span class=\"token punctuation\">(</span>\n                <span class=\"token class-name\">SatelliteImage</span><span class=\"token punctuation\">.</span><span class=\"token constant\">TABLE_NAME</span><span class=\"token punctuation\">,</span> <span class=\"token class-name\">TableSchema</span><span class=\"token punctuation\">.</span><span class=\"token function\">fromClass</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">SatelliteImage</span><span class=\"token punctuation\">.</span><span class=\"token keyword\">class</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n        <span class=\"token class-name\">PutItemEnhancedRequest</span><span class=\"token generics\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">SatelliteImage</span><span class=\"token punctuation\">></span></span> putItemRequest <span class=\"token operator\">=</span> <span class=\"token class-name\">PutItemEnhancedRequest</span><span class=\"token punctuation\">.</span><span class=\"token function\">builder</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">SatelliteImage</span><span class=\"token punctuation\">.</span><span class=\"token keyword\">class</span><span class=\"token punctuation\">)</span>\n                <span class=\"token punctuation\">.</span><span class=\"token function\">item</span><span class=\"token punctuation\">(</span>satelliteImage<span class=\"token punctuation\">)</span>\n                <span class=\"token punctuation\">.</span><span class=\"token function\">build</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        table<span class=\"token punctuation\">.</span><span class=\"token function\">putItem</span><span class=\"token punctuation\">(</span>putItemRequest<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span></code></pre></div>\n<p>To query a record, in our case, for example, by fieldId, do the following:</p>\n<div class=\"gatsby-highlight\" data-language=\"java\"><pre class=\"language-java\"><code class=\"language-java\">        <span class=\"token class-name\">DynamoDbTable</span><span class=\"token generics\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">SatelliteImage</span><span class=\"token punctuation\">></span></span> table <span class=\"token operator\">=</span> dynamoDbEnhancedClient<span class=\"token punctuation\">.</span><span class=\"token function\">table</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">SatelliteImage</span><span class=\"token punctuation\">.</span><span class=\"token constant\">TABLE_NAME</span><span class=\"token punctuation\">,</span>\n            <span class=\"token class-name\">TableSchema</span><span class=\"token punctuation\">.</span><span class=\"token function\">fromClass</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">SatelliteImage</span><span class=\"token punctuation\">.</span><span class=\"token keyword\">class</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n        <span class=\"token class-name\">PageIterable</span><span class=\"token generics\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">SatelliteImage</span><span class=\"token punctuation\">></span></span> scan <span class=\"token operator\">=</span> table<span class=\"token punctuation\">.</span><span class=\"token function\">scan</span><span class=\"token punctuation\">(</span>scanRequest<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n        <span class=\"token class-name\">Set</span><span class=\"token generics\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">SatelliteImage</span><span class=\"token punctuation\">></span></span> collect <span class=\"token operator\">=</span> scan\n            <span class=\"token punctuation\">.</span><span class=\"token function\">stream</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n            <span class=\"token punctuation\">.</span><span class=\"token function\">map</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">Page</span><span class=\"token operator\">::</span><span class=\"token function\">items</span><span class=\"token punctuation\">)</span>\n            <span class=\"token punctuation\">.</span><span class=\"token function\">flatMap</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">List</span><span class=\"token operator\">::</span><span class=\"token function\">stream</span><span class=\"token punctuation\">)</span>\n            <span class=\"token punctuation\">.</span><span class=\"token function\">collect</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">Collectors</span><span class=\"token punctuation\">.</span><span class=\"token function\">toSet</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></code></pre></div>\n<p>To integrate the dynamoDB into the Gitlab-CI Pipeline you can just start the service and pass the configuraiton</p>\n<div class=\"gatsby-highlight\" data-language=\"yaml\"><pre class=\"language-yaml\"><code class=\"language-yaml\">  <span class=\"token key atrule\">services</span><span class=\"token punctuation\">:</span>\n    <span class=\"token punctuation\">-</span> <span class=\"token key atrule\">name</span><span class=\"token punctuation\">:</span> amazon/dynamodb<span class=\"token punctuation\">-</span>local\n      <span class=\"token key atrule\">alias</span><span class=\"token punctuation\">:</span> dynamodb\n      <span class=\"token key atrule\">variables</span><span class=\"token punctuation\">:</span>\n        <span class=\"token key atrule\">AWS_ACCESS_KEY_ID</span><span class=\"token punctuation\">:</span> <span class=\"token string\">'DUMMYIDEXAMPLE'</span>\n        <span class=\"token key atrule\">AWS_SECRET_ACCESS_KEY</span><span class=\"token punctuation\">:</span> <span class=\"token string\">'DUMMYEXAMPLEKEY'</span>\n        <span class=\"token key atrule\">AWS_REGION</span><span class=\"token punctuation\">:</span> <span class=\"token string\">'eu-central-1'</span>\n  <span class=\"token key atrule\">variables</span><span class=\"token punctuation\">:</span>\n    <span class=\"token key atrule\">DYNAMODB_URL</span><span class=\"token punctuation\">:</span> <span class=\"token string\">\"http://dynamodb:8000\"</span></code></pre></div>\n<p>This was just a brief explanation on the \"more tricky\" parts of the integration. You should be fine with the rest, otherwise let me know to add more information to this article.</p>\n<p>Please also have a look at the official Documentation here: <a href=\"https://docs.aws.amazon.com/sdk-for-java/latest/developer-guide/examples-dynamodb.html\">https://docs.aws.amazon.com/sdk-for-java/latest/developer-guide/examples-dynamodb.html</a></p>","excerpt":"I had significant issues integrating DynamoDB into one of our projects. The main challenge was finding suitable documentation, as many sources describe…","frontmatter":{"date":"31 January, 2024","path":"/notes/java-dynamod-sdk3","title":"Integrate DynamoDB in Spring Boot and Gitlab-CI using aws sdk 2.x"},"timeToRead":4}},"pageContext":{}},"staticQueryHashes":["3649515864","63159454"],"slicesMap":{}}